<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.97dfbbefa5a0010b3611.css">:root{--color-primary:#3eb0ef;--color-base:#15171a;--color-secondary:#5b7a81;--color-border:#c7d5d8;--color-bg:#f5f5f5;--font-sans-serif:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;--font-serif:Georgia,Times,serif;--font-mono:Menlo,Courier,monospace;--font-light:100;--font-normal:400;--font-bold:700;--font-heavy:800;--height:4rem;--margin:2rem;--radius:0.6rem}a,abbr,acronym,address,applet,article,aside,audio,big,blockquote,body,canvas,caption,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,ul,var,video{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}img{max-width:100%}html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}a{background-color:transparent}a:active,a:hover{outline:0}b,strong{font-weight:700}dfn,em,i{font-style:italic}h1{margin:.67em 0;font-size:2em}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}mark{background-color:#fdffb6}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible;border:none}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input:focus{outline:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{box-sizing:content-box;-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}legend{padding:0;border:0}textarea{overflow:auto}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{overflow-y:scroll;font-size:62.5%;background:var(--color-base);-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{overflow-x:hidden}body{color:#3c484e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:1.5rem;line-height:1.6em;font-weight:400;font-style:normal;letter-spacing:0;text-rendering:optimizeLegibility;background:#fff;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-moz-font-feature-settings:"liga" on}::selection{text-shadow:none;background:#cbeafb}hr{position:relative;display:block;width:100%;margin:1.8em 0 2.4em;padding:0;height:1px;border:0;border-top:1px solid #e3e9ed}audio,canvas,iframe,img,svg,video{vertical-align:middle}fieldset{margin:0;padding:0;border:0}textarea{resize:vertical}blockquote,dl,ol,p,ul{margin:0 0 1.5em}ol,ul{padding-left:1.3em;padding-right:1.5em}ol ol,ol ul,ul ol,ul ul{margin:.5em 0 1em}ul{list-style:disc}ol{list-style:decimal}ol,ul{max-width:100%}li{margin:.5em 0;padding-left:.3em;line-height:1.6em}dt{float:left;margin:0 20px 0 0;width:120px;font-weight:500;text-align:right}dd{margin:0 0 5px;text-align:left}blockquote{margin:.3em 0 1.8em;padding:0 1.6em;border-left:.5em solid #cbeafb}blockquote p{margin:.8em 0;font-size:1.2em;font-weight:300}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;opacity:.8}blockquote small:before{content:"\2014   \A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}a{color:#26a8ed;text-decoration:none}a:hover{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-top:0;color:var(--color-base);line-height:1.15;font-weight:700;text-rendering:optimizeLegibility}h1{margin:0 0 .5em;font-size:4rem;font-weight:700}@media (max-width:500px){h1{font-size:2rem}}h2{margin:1.5em 0 .5em;font-size:2rem}@media (max-width:500px){h2{font-size:1.8rem}}h3{margin:1.5em 0 .5em;font-size:1.8rem;font-weight:500}@media (max-width:500px){h3{font-size:1.7rem}}h4{margin:1.5em 0 .5em;font-size:1.6rem;font-weight:500}h5,h6{margin:1.5em 0 .5em;font-size:1.4rem;font-weight:500}.viewport{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:space-between;justify-content:space-between;min-height:100vh}.container{max-width:1120px;margin:0 auto;padding:0 4vw}.content{margin:0 auto;font-size:2rem;line-height:1.7em}.content-body{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;font-family:var(--font-serif)}.post-full-content{max-width:720px;margin:0 auto;background:#fff}.post-feature-image img{margin:0 0 3vw;width:100%;height:500px;-o-object-fit:cover;object-fit:cover}.content-body h1,.content-body h2,.content-body h3,.content-body h4,.content-body h5,.content-body h6{font-family:var(--font-sans-serif)}.content-body h1{margin:1em 0 .5em;font-size:3.4rem;font-weight:700}@media (max-width:500px){.content-body h1{font-size:2.8rem}}.content-title{margin:0 0 .8em;font-size:5rem}@media (max-width:500px){.content-title{margin:.8em 0;font-size:3.4rem}.content{font-size:1.8rem}}.content-body h2{margin:.8em 0 .4em;font-size:3.2rem;font-weight:700}@media (max-width:500px){.content-body h2{font-size:2.6rem}}.content-body h3{margin:.5em 0 .2em;font-size:2.8rem;font-weight:700}@media (max-width:500px){.content-body h3{font-size:2.2rem}}.content-body h4{margin:.5em 0 .2em;font-size:2.4rem;font-weight:700}@media (max-width:500px){.content-body h4{font-size:2.2rem}}.content-body h5{display:block;margin:.5em 0;padding:1em 0 1.5em;border:0;font-family:Georgia,serif;color:var(--color-primary);font-style:italic;font-size:3.2rem;line-height:1.35em;text-align:center}.content-body h6{margin:.5em 0 .2em;font-size:2rem;font-weight:700}.content-body figure{margin:.4em 0 1.6em;font-size:2.8rem;font-weight:700}.content-body pre{margin:.4em 0 1.8em;font-size:1.6rem;line-height:1.4em;white-space:pre-wrap;padding:20px;border-radius:12px}.content-body pre,.site-head{background:var(--color-base);color:#fff}.site-head{padding-top:20px;padding-bottom:20px}.site-nav-item{display:inline-block;padding:5px 10px;color:#fff;opacity:.7}.site-nav-item:hover{text-decoration:none;opacity:1}.site-nav-icon{height:15px;margin:-5px 0 0}.site-logo{height:25px}.site-mast{-webkit-justify-content:space-between;justify-content:space-between}.site-mast,.site-mast-right{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.site-mast-right{margin:0 -10px 0 20px}.site-mast-right .site-nav-item:last-child{padding-right:0}.site-banner{max-width:80%;margin:0 auto;padding:1vw 0;text-align:center}.site-banner-title{margin:0;padding:0;color:#fff;font-size:4rem;line-height:1.3em}.site-banner-desc{margin:5px 0 0;padding:0;font-size:2.4rem;line-height:1.3em;opacity:.7}.site-nav{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:space-between;justify-content:space-between;margin:15px 0 0}.site-nav-left{margin:0 20px 0 -10px}.site-nav-right{margin:0 -10px 0 20px}.site-nav-button{display:inline-block;padding:5px 10px;border:1px solid #fff;color:#fff;font-size:1.3rem;line-height:1em;border-radius:var(--radius);opacity:.7}.site-nav-button:hover{text-decoration:none}.site-main{padding:4vw 0}.post-feed{display:grid;-webkit-justify-content:space-between;justify-content:space-between;grid-gap:30px;grid-template-columns:1fr 1fr 1fr}@media (max-width:980px){.post-feed{grid-template-columns:1fr 1fr}}@media (max-width:680px){.post-feed{grid-template-columns:1fr}}.post-card{color:inherit}.post-card,.post-card:hover{text-decoration:none}.post-card-tags{margin:0 0 5px;font-size:1.4rem;line-height:1.15em;color:var(--color-secondary)}.post-card-title{margin:0 0 10px;padding:0}.post-card-excerpt{font-size:1.6rem;line-height:1.55em}.post-card-image{margin:0 0 10px;width:auto;height:200px;background:var(--color-secondary) no-repeat 50%;background-size:cover}.post-card-footer{-webkit-justify-content:space-between;justify-content:space-between;margin:10px 0 0;color:var(--color-secondary)}.post-card-footer,.post-card-footer-left{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.post-card-footer-right{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column}.post-card-avatar{width:30px;height:30px;margin:0 7px 0 0;border-radius:100%;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.post-card-avatar .author-profile-image{display:block;width:100%;background:var(--color-secondary);border-radius:100%;-o-object-fit:cover;object-fit:cover}.post-card-avatar .default-avatar{width:26px}.tag-header{max-width:690px;margin:0 0 4vw}.tag-header h1{margin:0 0 1rem}.tag-header p{margin:0;color:var(--color-secondary);font-size:2.2rem;line-height:1.3em}@media (max-width:500px){.tag-header{border-bottom:1px solid var(--color-bg);padding-bottom:4vw}.tag-header p{font-size:1.7rem}}.author-header{display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between;margin:0 0 4vw}.author-header h1{margin:0 0 1rem}.author-header p{margin:0;color:var(--color-secondary);font-size:2.2rem;line-height:1.3em}.author-header-image{-webkit-flex:0 0 auto;flex:0 0 auto;margin:0 0 0 4vw;height:120px;width:120px;border-radius:100%;overflow:hidden}.author-header-meta{display:-webkit-flex;display:flex;margin:1rem 0 0}.author-header-item{display:block;padding:2px 10px}.author-header-item:first-child{padding-left:0}@media (max-width:500px){.author-header{border-bottom:1px solid var(--color-bg);padding-bottom:4vw}.author-header p{font-size:1.7rem}.author-header-image{height:80px;width:80px}}.pagination{position:relative;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;align-items:center;margin:4vw 0 0}.pagination a{display:inline-block;padding:10px 15px;border:1px solid var(--color-border);color:var(--color-secondary);text-decoration:none;font-size:1.4rem;line-height:1em;border-radius:var(--radius)}.pagination-location{position:absolute;left:50%;width:100px;margin-left:-50px;text-align:center;color:var(--color-secondary);font-size:1.3rem}.site-foot{padding:20px 0 40px;color:hsla(0,0%,100%,.7);font-size:1.3rem;background:var(--color-base)}.site-foot-nav{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:space-between;justify-content:space-between}.site-foot-nav a{color:hsla(0,0%,100%,.7)}.site-foot-nav a:hover{text-decoration:none;color:#fff}.site-foot-nav-right a{display:inline-block;padding:2px 5px}.site-foot-nav-right a:last-child{padding-right:0}</style><meta name="generator" content="Gatsby 2.1.30"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#15171A"/><link rel="alternate" type="application/rss+xml" href="/rss"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Speeding Up Webpack, Typescript Incremental Builds by 7x</title><link data-react-helmet="true" rel="canonical" href="/speeding-up-webpack-typescript-incremental-builds-by-7x/"/><meta data-react-helmet="true" name="description" content="What if I told you your Webpack is doing too much work all this time? Webpack 4
brought a lot of goodies for developers but to use it at scale, the Outlook
[http://outlook.com/]  team at Microsoft had to take a hard look at the
incremental build numbers to find out. Here’s how we made our incremental builds
go from 35s to a consistent 5s.

I guess it goes without saying that you MUST measure in order for you to know
you have made progress!

Let’s name some enemies of incremental build speed:

 1"/><meta data-react-helmet="true" property="og:site_name" content="Crash Test Dev"/><meta data-react-helmet="true" name="og:type" content="article"/><meta data-react-helmet="true" name="og:title" content="Speeding Up Webpack, Typescript Incremental Builds by 7x"/><meta data-react-helmet="true" name="og:description" content="What if I told you your Webpack is doing too much work all this time? Webpack 4
brought a lot of goodies for developers but to use it at scale, the Outlook
[http://outlook.com/]  team at Microsoft had to take a hard look at the
incremental build numbers to find out. Here’s how we made our incremental builds
go from 35s to a consistent 5s.

I guess it goes without saying that you MUST measure in order for you to know
you have made progress!

Let’s name some enemies of incremental build speed:

 1"/><meta data-react-helmet="true" property="og:url" content="/speeding-up-webpack-typescript-incremental-builds-by-7x/"/><meta data-react-helmet="true" property="article:published_time" content="2018-04-06T22:58:00.000+00:00"/><meta data-react-helmet="true" property="article:modified_time" content="2019-03-26T22:59:55.000+00:00"/><meta data-react-helmet="true" name="twitter:title" content="Speeding Up Webpack, Typescript Incremental Builds by 7x"/><meta data-react-helmet="true" name="twitter:description" content="What if I told you your Webpack is doing too much work all this time? Webpack 4
brought a lot of goodies for developers but to use it at scale, the Outlook
[http://outlook.com/]  team at Microsoft had to take a hard look at the
incremental build numbers to find out. Here’s how we made our incremental builds
go from 35s to a consistent 5s.

I guess it goes without saying that you MUST measure in order for you to know
you have made progress!

Let’s name some enemies of incremental build speed:

 1"/><meta data-react-helmet="true" name="twitter:url" content="/speeding-up-webpack-typescript-incremental-builds-by-7x/"/><meta data-react-helmet="true" name="twitter:label1" content="Written by"/><meta data-react-helmet="true" name="twitter:data1" content="Ken Chau"/><meta data-react-helmet="true" name="twitter:site" content="https://twitter.com/kenneth_chau/"/><meta data-react-helmet="true" name="twitter:creator" content="@kenneth_chau"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image" content="https://images.unsplash.com/photo-1534078362425-387ae9668c17?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ"/><meta data-react-helmet="true" property="og:image" content="https://images.unsplash.com/photo-1534078362425-387ae9668c17?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ"/><meta data-react-helmet="true" property="og:image:width" content="1000"/><meta data-react-helmet="true" property="og:image:height" content="523"/><script data-react-helmet="true" type="application/ld+json">
                    {
                        "@context": "https://schema.org/",
                        "@type": "Article",
                        "author": {
                            "@type": "Person",
                            "name": "Ken Chau",
                            "image": "//www.gravatar.com/avatar/45fc02e659e008e7b53c0b8ee8dd71a1?s=250&d=mm&r=x",
                            "sameAs": ["https://twitter.com/kenotron/"]
                        },
                        
                        "headline": "Speeding Up Webpack, Typescript Incremental Builds by 7x",
                        "url": "/speeding-up-webpack-typescript-incremental-builds-by-7x/",
                        "datePublished": "2018-04-06T22:58:00.000+00:00",
                        "dateModified": "2019-03-26T22:59:55.000+00:00",
                        "image": {
                                "@type": "ImageObject",
                                "url": "https://images.unsplash.com/photo-1534078362425-387ae9668c17?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ",
                                "width": "1000",
                                "height": "523"
                            },
                        "publisher": {
                            "@type": "Organization",
                            "name": "Crash Test Dev",
                            "logo": {
                                "@type": "ImageObject",
                                "url": "favicon.png",
                                "width": 60,
                                "height": 60
                            }
                        },
                        "description": "What if I told you your Webpack is doing too much work all this time? Webpack 4
brought a lot of goodies for developers but to use it at scale, the Outlook
[http://outlook.com/]  team at Microsoft had to take a hard look at the
incremental build numbers to find out. Here’s how we made our incremental builds
go from 35s to a consistent 5s.

I guess it goes without saying that you MUST measure in order for you to know
you have made progress!

Let’s name some enemies of incremental build speed:

 1",
                        "mainEntityOfPage": {
                            "@type": "WebPage",
                            "@id": "crashtestdev.com"
                        }
                    }
                </script><link as="script" rel="preload" href="/component---src-templates-post-js-6f785b7181a131fefa27.js"/><link as="script" rel="preload" href="/app-31063e343054e35ed906.js"/><link as="script" rel="preload" href="/styles-a9af8393e08fe942273a.js"/><link as="script" rel="preload" href="/2-0d273981286aa49dd7a9.js"/><link as="script" rel="preload" href="/3-372fd3160d52526c7d24.js"/><link as="script" rel="preload" href="/1-2af2b0591fa831e7930f.js"/><link as="script" rel="preload" href="/webpack-runtime-e31850d2cba0dab4025a.js"/><link as="fetch" rel="preload" href="/static/d/470/path---speeding-up-webpack-typescript-incremental-builds-by-7-x-f-30-124-p3Sr4zaTlsGSO31uulCsioFyI.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="viewport"><div class="viewport-top"><header class="site-head"><div class="container"><div class="site-mast"><div class="site-mast-left"></div><div class="site-mast-right"><a href="https://twitter.com/kenneth_chau" class="site-nav-item" target="_blank" rel="noopener noreferrer"><img class="site-nav-icon" src="/images/icons/twitter.svg" alt="Twitter"/></a><a class="site-nav-item" href="https://feedly.com/i/subscription/feed/crashtestdev.com/rss/" target="_blank" rel="noopener noreferrer"><img class="site-nav-icon" src="/images/icons/rss.svg" alt="RSS Feed"/></a></div></div><nav class="site-nav"><div class="site-nav-left"></div></nav></div></header><main class="site-main"><div class="container"><article class="content"><figure class="post-feature-image"><img src="https://images.unsplash.com/photo-1534078362425-387ae9668c17?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Speeding Up Webpack, Typescript Incremental Builds by 7x"/></figure><section class="post-full-content"><h1 class="content-title">Speeding Up Webpack, Typescript Incremental Builds by 7x</h1><section class="content-body load-external-scripts"><p>What if I told you your Webpack is doing too much work all this time? Webpack 4 brought a lot of goodies for developers but to use it at scale, the <a href="http://outlook.com/" rel="nofollow noopener noopener">Outlook</a> team at Microsoft had to take a hard look at the incremental build numbers to find out. Here’s how we made our incremental builds go from 35s to a consistent 5s.</p><p><em>I guess it goes without saying that you MUST measure in order for you to know you have made progress!</em></p><p>Let’s name some enemies of incremental build speed:</p><ol><li><a href="https://webpack.js.org/api/node/#stats-tojson-options-" rel="noopener nofollow">stats.toJson</a>()</li><li>Competing resolution logic between Webpack and its loaders (<a href="https://github.com/TypeStrong/ts-loader" rel="noopener nofollow">ts-loader</a>)</li><li>Garbage Collection</li><li>Subtle v8 ES6 perfomance issues</li></ol><h3 id="the-base-line">The Base Line</h3><p>To begin, there are already a few things <em>beyond</em> setting the mode in <code>webpack.config.js</code> we <em>already</em> apply so we’re not doing too much optimization during incremental builds:</p><!--kg-card-begin: markdown--><pre><code class="language-js">optimization: {
  removeAvailableModules: false,
  removeEmptyChunks: false,
  splitChunks: false,
}
</code></pre>
<!--kg-card-end: markdown--><p>Alright, so let’s establish the baseline by looking at a typical inner loop flame graph:</p><!--kg-card-begin: image--><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2019/03/image.png" class="kg-image"></figure><!--kg-card-end: image--><p>As you can see, we’re clocking in at around 40s here per incremental build. This is not exactly true because we lose about 5s of it due to profiling. In measuring with our internal telemetry, we noticed that our devs are hitting around 30–35s on avg (and sometimes over a minute at the 75th percentile) incremental builds.</p><p>So, as soon as you look at those colors, you would recognize three separate phases of the incremental build process. With this in mind, let’s tackle the first enemy.</p><h3 id="enemy-1-stats-tojson-is-very-heavy-in-wp4">Enemy #1: stats.toJson is VERY heavy in WP4</h3><p>If you were looking at the the CPU profile flame graph, you would notice that the last phase of the process is dominated by a bunch of <strong><strong>stats.toJson</strong></strong> calls. Where does it come from? It’s right inside <strong><strong>webpack-dev-server</strong></strong>’s Server.js:</p><!--kg-card-begin: markdown--><pre><code class="language-js">const clientStats = { errorDetails: false };
...
comp.hooks.done.tap('webpack-dev-server', (stats) =&gt; {
  this._sendStats(this.sockets, stats.toJson(clientStats));
  this._stats = stats;
});
</code></pre>
<!--kg-card-end: markdown--><p>The issue here is that Webpack 4 gave toJson a lot more information, but it also regressed the performance tremendously as a result. The fix is in a pull request:</p><p><a href="https://github.com/webpack/webpack-dev-server/pull/1362">https://github.com/webpack/webpack-dev-server/pull/1362</a></p><p><strong><strong>This is the big one — it brought our incremental speeds from 30s to around 15s.</strong></strong></p><p><strong><strong>Update</strong></strong>: the webpack-dev-server maintainers had accepted my patch! So, go ahead and use webpack-dev-server@3.1.2. Personally, I have observed a slight 0.5s regression between 2.x release and the 3.x release, so we’re keeping the 2.x for now until we can move to using webpack-serve.</p><p>Since we’re waiting for the authors to merge this for v2, I’ve published a temporary fork for it for the v2 branch:</p><p><a href="https://www.npmjs.com/package/webpack-dev-server-speedy">https://www.npmjs.com/package/webpack-dev-server-speedy</a></p><p>For the fix on v2, you’ll have to use the node API to take advantage of it like this package in your build process:</p><!--kg-card-begin: markdown--><pre><code class="language-js">const Webpack = require('webpack');
const WebpackDevServer = require('webpack-dev-server-speedy');
const webpackConfig = require('./webpack.config');
const compiler = Webpack(webpackConfig);
const devServerOptions = Object.assign({}, webpackConfig.devServer, {
  stats: {
    colors: true
  }
});
const server = new WebpackDevServer(compiler, devServerOptions);
server.listen(8080, '127.0.0.1', () =&gt; {
  console.log('Starting server on http://localhost:8080');
});
</code></pre>
<!--kg-card-end: markdown--><h3 id="enemy-2-competing-resolution-logic-between-webpack-and-ts-loader">Enemy #2: Competing resolution logic between Webpack and ts-loader</h3><p>If I were to ask you to build an incremental compiler based on Typescript, you would likely first reach into the Typescript API for something that it is using for its watch mode. For the longest time, Typescript safe guarded this API from external modules. During this time, ts-loader was born. The author of the loader tracked the progress of another Typescript-centric loader called awesome-typescript-loader and brought back the idea of doing type checking on a separate thread. This <em>transpileOnly</em> flag worked remarkably well (with a rather glaring caveat that const enums are not supported out of the box — here’s a <a href="https://github.com/kulshekhar/ts-jest#const-enum-is-not-supported" rel="noopener nofollow">workaround</a> from the ts-jest repo) until the codebase reaches a certain size.</p><p>In OWA, we have nearly 9000 modules that we shove across this loader. We have found that the first phase of that incremental build is linearly growing as our repo grows.</p><p>Things looked pretty grim until the Typescript team decided to take on this mammoth work of expose the watch API to external modules. Specifically, after <a href="https://github.com/TypeStrong/ts-loader/pull/685" rel="noopener nofollow">this</a> was merged, ts-loader is super charged with the ability to limit the amount of modules to transpile at a time per iteration!</p><p>We just add this to our webpack config <strong><strong>module.rules</strong></strong>:</p><!--kg-card-begin: markdown--><pre><code>{
  test: /\.tsx?$/,
  use: [
    {
      loader: 'ts-loader',
      options: {
        transpileOnly: true,
        experimentalWatchApi: true,
      },
    },
  ],
}
</code></pre>
<!--kg-card-end: markdown--><p><em>Don’t forget to the typechecker when appropriate: </em><a href="https://www.npmjs.com/package/fork-ts-checker-webpack-plugin" rel="nofollow noopener nofollow noopener"><em>https://www.npmjs.com/package/fork-ts-checker-webpack-plugin</em></a><em> (we have a mode to turn type checker OFF for even faster rebuilds)</em></p><p>The incremental builds now only rebuilds around 30–40 modules rather than 50% of our modules! I also have a way to CAP the growth of the incremental builds in the first phase.</p><p><strong><strong>This optimization cuts our 15s to around 8s</strong></strong>.</p><h3 id="enemy-3-garbage-collection"><strong>Enemy #3: Garbage Collection</strong></h3><p>So Garbage Collection is a great invention. But not in a tight loop. Perhaps there’s a perf bug inside node or v8, but I’ve discovered that a global <strong><strong>string.replace(/…/g, ‘…..’) can cause a lot of GC</strong></strong> when placed inside a loop. Webpack 4 introduced the path info in the generated dev mode replacing module ids with more useful path info. This is done with, you guessed it, global string replace with regex. It then created a LOT of unnecessary GCs along the way. (<em>as an aside, perhaps I should file a bug against either Webpack, node, or v8…</em>)</p><p>Okay, let’s turn that sucker off in webpack.config.js in the output.pathinfo:</p><!--kg-card-begin: code--><pre><code>output: {
  pathinfo: false
}</code></pre><!--kg-card-end: code--><p>Just ask yourself if you REALLY need that pathinfo or that build speed. For us, we chose speed. <strong><strong>This made our 8s builds to around 6s</strong></strong></p><h3 id="enemy-4-subtle-v8-es6-perfomance-issues">Enemy #4: Subtle v8 ES6 perfomance issues</h3><p>Most everyone would be pleased with that 6s figure, but why should we humans not demand MOAR? Yes, MOAR speed!!!</p><p>In chatting with a colleague of mine, <a href="https://github.com/jdalton" rel="nofollow noopener">John-David Dalton</a>, about his project, <a href="https://medium.com/web-on-the-edge/tomorrows-es-modules-today-c53d29ac448c">esm</a>, he told me about node.js performance issues with ES6 data structures like Map and Set. Having dug into Webpack source code previously <em>and</em> by looking at the remaining profile slowdowns (looking at the “heavy” or “bottom-up”), I noticed that Webpack’s internal algorithm is dominated by calling their SortableSet methods. Since SortableSet extends Set, it would follow that Webpack is actually greatly affected by the speed of the Map/Set implementation of V8. Here’s the bug:</p><p><a href="https://github.com/nodejs/node/issues/19769">https://github.com/nodejs/node/issues/19769</a></p><p>So, I advise everyone doing heavy Webpack development to switch to the LTS (v10+ or stick with v8.9.4)</p><p><strong><strong>Using that version, the incremental build is down to 4.5s</strong></strong></p><h3 id="why-inventing-on-principle-">Why? Inventing on Principle!</h3><p>Finally, I want to leave you with the best motivation on why we should reduce this incremental build speeds down to almost nothing:</p><!--kg-card-begin: embed--><figure class="kg-card kg-embed-card"><iframe src="https://player.vimeo.com/video/36579366?app_id=122963" width="480" height="270" frameborder="0" title="Bret Victor - Inventing on Principle" allow="autoplay; fullscreen" allowfullscreen></iframe></figure><!--kg-card-end: embed--><p>Hey! follow me on twitter <a href="https://twitter.com/kenneth_chau">@kenneth_chau</a> to get more articles like these :)</p></section></section></article></div></main></div><div class="viewport-bottom"><footer class="site-foot"><div class="site-foot-nav container"><div class="site-foot-nav-left"><a href="/">Crash Test Dev</a> © 2019 — Published with<!-- --> <a class="site-foot-nav-item" href="https://ghost.org" target="_blank" rel="noopener noreferrer">Ghost</a></div><div class="site-foot-nav-right"></div></div></footer></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-js","jsonName":"speeding-up-webpack-typescript-incremental-builds-by-7-x-f30","path":"/speeding-up-webpack-typescript-incremental-builds-by-7x/"};window.dataPath="470/path---speeding-up-webpack-typescript-incremental-builds-by-7-x-f-30-124-p3Sr4zaTlsGSO31uulCsioFyI";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-31063e343054e35ed906.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-738b71b7a247eda9fd10.js"],"component---src-templates-post-js":["/component---src-templates-post-js-6f785b7181a131fefa27.js"],"component---src-templates-index-js":["/component---src-templates-index-js-86773c881c58b78ac5cc.js"],"component---src-templates-author-js":["/component---src-templates-author-js-6b727cf2de3f9dda3779.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cfddc3d7439ceea93744.js"],"pages-manifest":["/pages-manifest-c5e2a3112876171b9d49.js"]};/*]]>*/</script><script src="/webpack-runtime-e31850d2cba0dab4025a.js" async=""></script><script src="/1-2af2b0591fa831e7930f.js" async=""></script><script src="/3-372fd3160d52526c7d24.js" async=""></script><script src="/2-0d273981286aa49dd7a9.js" async=""></script><script src="/styles-a9af8393e08fe942273a.js" async=""></script><script src="/app-31063e343054e35ed906.js" async=""></script><script src="/component---src-templates-post-js-6f785b7181a131fefa27.js" async=""></script></body></html>